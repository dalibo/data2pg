image:
  name: docker/compose:latest

services:
  - docker:dind

before_script:
  - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" $CI_REGISTRY
  - apk add --no-cache docker-compose make bash rsync #perl perl-dev perl-dbi perl-test-simple perl-test-nowarnings perl-dbd-pg

variables:
  SHARED_PATH: $CI_PROJECT_DIR/shared

build:
  stage: build
  script:
    - make stop
    - make build
    - make up
    - docker-compose exec -T web echo 'Web is running'
    - docker-compose exec -T database echo 'Database is running'
    #- make dc-test
